# frontend/nginx.conf
server {
  listen 80;
  server_name _;

  # Serve the built site
  root /usr/share/nginx/html;
  index index.html;

  # --- Common proxy settings (inherit via include) ---
  # We keep them inline for a single-file config
  # so you don't need extra includes.
  set $proxy_upstream_host "";
  proxy_redirect          off;
  proxy_http_version      1.1;
  proxy_set_header        Host                $host;
  proxy_set_header        X-Real-IP           $remote_addr;
  proxy_set_header        X-Forwarded-For     $proxy_add_x_forwarded_for;
  proxy_set_header        X-Forwarded-Proto   $scheme;
  proxy_connect_timeout   5s;
  proxy_send_timeout      60s;
  proxy_read_timeout      60s;

  # If you upload images/files via the Product service, allow reasonable size
  client_max_body_size 20m;

  # ---------- API reverse proxies ----------
  # Customer API
  location /customers/ {
    proxy_pass http://customer-service-w08e1:8002/;
  }

  # Product API
  location /products/ {
    proxy_pass http://product-service-w08e1:8000/;
  }

  # Order API
  location /orders/ {
    proxy_pass http://order-service-w08e1:8001/;
  }

  # ---------- Static app routing ----------
  # If the path isn't a real file, serve index.html (so SPA routes work)
  location / {
    try_files $uri /index.html;
  }
}
